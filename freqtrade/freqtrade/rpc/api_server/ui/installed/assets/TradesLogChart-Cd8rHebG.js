import{d as $,K as k,j as x,c as W,a as T,e as C,l as w,k as O,f as m,n as K,b as q,a5 as J,t as L,a$ as H,r as Q,b6 as X,o as Y,b7 as tt,U as et,D as j,b8 as ot,A as at}from"./index-D1nGKoiE.js";import{u as S,s as D,i as I,a as A,b as B,c as R,d as z}from"./installCanvasRenderer-4trk6N7K.js";import{e as M,o as N,c as G,i as U,b as st,d as Z,f as rt,k as nt}from"./chartZoom-pugbQQdv.js";function it(l,o){const r=Math.min(...l),p=(Math.max(...l)-r)*1.01/o,u=[...Array(o).keys()].map(s=>[Math.round((r+s*p)*1e3)/1e3,0]);for(let s=0;s<l.length;s++){const e=Math.min(Math.floor((l[s]-r)/p),o-1);isNaN(e)||u[e][1]++}return u}const lt={class:"flex flex-col h-full relative"},ct={class:"grow mb-2"},P="Trade count",dt=$({__name:"ProfitDistributionChart",props:{trades:{},showTitle:{type:Boolean,default:!0}},setup(l){S([N,I,A,G,B,R,z]);const o=l,r=k(),_=[{text:"10",value:10},{text:"15",value:15},{text:"20",value:20},{text:"25",value:25},{text:"50",value:50}],p=x(()=>{const s=o.trades.map(e=>e.profit_ratio);return it(s,r.profitDistributionBins)}),u=x(()=>({title:{text:"Profit distribution",left:"center",show:o.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",dataset:{source:p.value},tooltip:{trigger:"axis",axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},legend:{data:[P],right:"5%",top:0,selectedMode:!1},xAxis:{type:"category",name:"Profit %",nameLocation:"middle",nameGap:25},yAxis:[{type:"value",name:P,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:35,position:"left"}],grid:{...M,bottom:50},series:[{type:"bar",name:P,animation:!0,encode:{x:"x0",y:"y0"}}]}));return(s,e)=>{const d=J;return T(),W("div",lt,[C("div",ct,[l.trades?(T(),w(m(D),{key:0,option:m(u),autoresize:"",theme:m(r).chartTheme},null,8,["option","theme"])):O("",!0)]),C("div",{class:K(["z-2 absolute fixed-top flex items-center gap-10 ms-2",{"mx-auto":l.showTitle}]),"label-for":"input-bins",size:"sm"},[e[1]||(e[1]=C("label",{for:"input-bins"},"Bins",-1)),q(d,{id:"input-bins",modelValue:m(r).profitDistributionBins,"onUpdate:modelValue":e[0]||(e[0]=h=>m(r).profitDistributionBins=h),size:"small","option-label":"text","option-value":"value",class:"mt-1",options:_},null,8,["modelValue"])],2)])}}}),_t=L(dt,[["__scopeId","data-v-52e8fdf9"]]),v="Profit",pt=$({__name:"CumProfitChart",props:{trades:{},openTrades:{default:()=>[]},showTitle:{type:Boolean,default:!0},profitColumn:{default:"profit_abs"}},setup(l){S([N,U,I,A,G,st,B,R,z]);const o=l,r=k(),_=H(),p=Q(),u=x(()=>o.openTrades.reduce((t,n)=>t+(n.total_profit_abs??n[o.profitColumn]??0),0)),s=x(()=>{const t={},n=o.trades.slice().sort((c,f)=>c.close_timestamp>f.close_timestamp?1:-1);let i=0,y=!0;for(let c=0,f=n.length;c<f;c+=1){const a=n[c];if(a&&(y&&(y=!1,t[a.open_timestamp]?t[a.open_timestamp][a.botId]=i:t[a.open_timestamp]={profit:i,[a.botId]:i}),a.close_timestamp&&a[o.profitColumn])){i+=a[o.profitColumn];const g=t[a.close_timestamp];g?(g.profit+=a[o.profitColumn],g[a.botId]?g[a.botId]+=a[o.profitColumn]:g[a.botId]=i):t[a.close_timestamp]={profit:i,[a.botId]:i}}}const b=Object.entries(t).map(([c,f])=>({date:parseInt(c,10),profit:f.profit}));if(o.openTrades.length>0){let c=0,f=0;const a=b[b.length-1];if(a)c=a.profit??0,f=a.date??0;else{const V=o.openTrades[0];f=V?V.open_timestamp:0}const g=(c??0)+u.value;b.push({date:f,currentProfit:c});const E=Date.now()+1440*60*1e3;b.push({date:E,currentProfit:g})}return b});function e(t=!1){const{colorProfit:n,colorLoss:i}=_;return{dataset:{dimensions:["date","profit","currentProfit"],source:s.value},series:[{type:"line",name:"currentProfit",animation:t,lineStyle:{color:u.value>0?n:i,type:"dotted"},itemStyle:{color:u.value>0?n:i},encode:{x:"date",y:"currentProfit"}},{type:"line",name:v,animation:t,step:"end",lineStyle:{color:r.chartTheme==="dark"?"#c2c2c2":"black"},itemStyle:{color:r.chartTheme==="dark"?"#c2c2c2":"black"},encode:{x:"date",y:"profit"}}]}}function d(t=!1){const n=e(t);p.value?.setOption(n,{replaceMerge:["series","dataset"]})}const h=X(()=>o.trades,()=>{const t={title:{text:"Cumulative Profit",left:"center",show:o.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",tooltip:{trigger:"axis",formatter:i=>{const y=i[0].data.profit,b=i[0].data.currentProfit,c=b?`Projected profit (incl. unrealized): ${j(b,3)}`:`Profit: ${j(y,3)}`;return`${ot(i[1].data.date)}<br />${i[1].marker}${c}`},axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},legend:{data:[v],right:"5%",top:0,selectedMode:!1},useUTC:!1,xAxis:{type:"time"},yAxis:[{type:"value",name:v,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:40}],grid:{...M},dataZoom:[{type:"inside",start:0,end:100},{bottom:10,start:0,end:100,...Z}]},n=e(!1);return t.series=n.series,t.dataset=n.dataset,t});return Y(()=>{}),tt(()=>o.openTrades,()=>{d()},{throttle:60*1e3}),et(()=>r.chartTheme,()=>{h.trigger()}),(t,n)=>l.trades?(T(),w(m(D),{key:0,ref_key:"chart",ref:p,option:m(h),theme:m(r).chartTheme,autoresize:""},null,8,["option","theme"])):O("",!0)}}),gt=L(pt,[["__scopeId","data-v-82bc82ad"]]),F="Profit %",mt="#9be0a8",ut=$({__name:"TradesLogChart",props:{trades:{},showTitle:{type:Boolean,default:!0}},setup(l){S([N,U,I,A,G,B,R,z,rt,nt]);const o=l,r=k(),_=H(),p=x(()=>{const s=[],e=o.trades.slice(0).sort((d,h)=>d.close_timestamp>h.close_timestamp?1:-1);for(let d=0,h=e.length;d<h;d+=1){const t=e[d];if(t){const n=[d,(t.profit_ratio*100).toFixed(2),t.pair,t.botName,at(t.close_timestamp),t.is_short===void 0||!t.is_short?"Long":"Short"];s.push(n)}}return s}),u=x(()=>{const s=p.value.length>0?(1-50/p.value.length)*100:100;return{title:{text:"Trades log",left:"center",show:o.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",dataset:{dimensions:["date","profit"],source:p.value},tooltip:{trigger:"axis",formatter:e=>{const d=e[0].data[3]?` | ${e[0].data[3]}`:"";return`${e[0].data[2]} | ${e[0].data[5]} ${d}<br>${e[0].data[4]}<br>Profit ${e[0].data[1]} %`},axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},xAxis:{type:"category",show:!1},yAxis:[{type:"value",name:F,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:30}],grid:{...M,left:80},dataZoom:[{type:"inside",start:s,end:100},{bottom:10,start:s,end:100,...Z}],visualMap:[{show:!0,seriesIndex:0,pieces:[{max:0,color:_.colorLoss},{min:0,color:_.colorProfit}]}],series:[{type:"bar",name:F,barCategoryGap:"0%",animation:!1,label:{show:!0,position:"top",rotate:90,offset:[7.5,7.5],formatter:"{@[1]} %",color:r.chartTheme==="dark"?"#c2c2c2":"#3c3c3c"},encode:{x:0,y:1},itemStyle:{color:mt}}]}});return(s,e)=>l.trades.length>0?(T(),w(m(D),{key:0,option:m(u),autoresize:"",theme:m(r).chartTheme},null,8,["option","theme"])):O("",!0)}}),xt=L(ut,[["__scopeId","data-v-247a246a"]]);export{xt as _,gt as a,_t as b};
//# sourceMappingURL=TradesLogChart-Cd8rHebG.js.map
